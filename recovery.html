<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="description" content="Recovery Request Form - Forensic Video Unit">
  <title>Recovery Request - Forensic Video Unit</title>

  <!-- PWA Configuration -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#1B3A6B">

  <!-- iOS PWA Support -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="FVU Requests">

  <!-- iOS Icons -->
  <link rel="apple-touch-icon" href="/assets/images/icons/icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/icons/icon-180x180.png">

  <!-- iOS Splash Screen - iPhone 16 Pro -->
  <link rel="apple-touch-startup-image"
        href="/assets/images/splash/splash-1206x2622.png"
        media="(device-width: 402px) and (device-height: 874px) and (-webkit-device-pixel-ratio: 3)">

  <!-- Windows/Edge -->
  <meta name="msapplication-TileColor" content="#1B3A6B">
  <meta name="msapplication-TileImage" content="/assets/images/icons/icon-144x144.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/icons/icon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/icons/icon-16x16.png">

  <!-- CSS Files -->
  <link rel="stylesheet" href="assets/css/forms.css">
  <link rel="stylesheet" href="assets/css/header.css">
  <link rel="stylesheet" href="assets/css/notifications.css">

  <!-- Early theme initialization to prevent FOUC -->
  <script>
    // Prevent flash of unstyled content by setting theme before body renders
    document.documentElement.setAttribute('data-theme',
      localStorage.getItem('fvu-theme') || 'dark');
  </script>

  <!-- Libraries -->
  <script src="lib/pdfmake.min.js"></script>
  <script src="lib/vfs_fonts.js"></script>
</head>
<body>
  <!-- Animated Background -->
  <div class="background-animation">
    <div class="grid-overlay"></div>
    <div class="floating-shapes">
      <div class="shape shape-1"></div>
      <div class="shape shape-2"></div>
      <div class="shape shape-3"></div>
    </div>
  </div>

  <!-- Header injected by header-component.js -->

  <!-- Main Form Content -->
  <main class="container" style="padding: 2rem 1rem; max-width: 800px;">
    <form id="recovery-form" novalidate>
      <!-- Hidden session field for PHP -->
      <!-- <input type="hidden" name="session_verify" value="<?php echo session_id(); ?>"> -->

      <!-- Case Information Section -->
      <section class="form-section">
        <h2 style="color: var(--color-primary); margin-bottom: 1.5rem;">Case Information</h2>

        <!-- Row 1: Occurrence Number + Date of Occurrence -->
        <div class="form-row">
          <div class="form-group">
            <label for="occNumber" class="form-label">
              Occurrence Number <span class="required">*</span>
            </label>
            <input type="text"
                   class="form-control"
                   id="occNumber"
                   name="occNumber"
                   placeholder="e.g., PR240368708"
                   required>
            <small class="form-text">Format: PR followed by numbers</small>
            <div class="invalid-feedback"></div>
          </div>

          <div class="form-group">
            <label for="occDate" class="form-label">
              Date of Occurrence <span class="required">*</span>
            </label>
            <input type="date"
                   class="form-control"
                   id="occDate"
                   name="occDate"
                   required>
            <div class="invalid-feedback"></div>
          </div>
        </div>

        <!-- Row 2: Type of Offence -->
        <div class="form-row">
          <div class="form-group">
            <label for="offenceType" class="form-label">
              Type of Offence <span class="required">*</span>
            </label>
            <select class="form-control" id="offenceType" name="offenceType" required>
              <option value="">Select offence type</option>
              <option value="Homicide">Homicide</option>
              <option value="Missing Person">Missing Person</option>
            </select>
            <div class="invalid-feedback"></div>
          </div>
        </div>
      </section>

      <!-- Investigator Information Section -->
      <section class="form-section">
        <h2 style="color: var(--color-primary); margin-bottom: 1.5rem;">Submitting Investigator Information</h2>

        <!-- Row 1: Investigator Name + Badge -->
        <div class="form-row">
          <div class="form-group">
            <label for="rName" class="form-label">
              Submitting Investigator <span class="required">*</span>
            </label>
            <input type="text"
                   class="form-control"
                   id="rName"
                   name="rName"
                   placeholder="Last name or full name"
                   required>
            <div class="invalid-feedback"></div>
          </div>

          <div class="form-group">
            <label for="badge" class="form-label">
              Badge Number <span class="required">*</span>
            </label>
            <input type="text"
                   class="form-control"
                   id="badge"
                   name="badge"
                   placeholder="Investigator badge number"
                   required>
            <div class="invalid-feedback"></div>
          </div>
        </div>

        <!-- Row 2: Phone + Email -->
        <div class="form-row">
          <div class="form-group">
            <label for="requestingPhone" class="form-label">
              Contact Number <span class="required">*</span>
            </label>
            <input type="tel"
                   class="form-control"
                   id="requestingPhone"
                   name="requestingPhone"
                   placeholder="XXX-XXX-XXXX"
                   required>
            <small class="form-text">10 digits required (dashes optional)</small>
            <div class="invalid-feedback"></div>
          </div>

          <div class="form-group">
            <label for="requestingEmail" class="form-label">
              Email Address <span class="required">*</span>
            </label>
            <input type="email"
                   class="form-control"
                   id="requestingEmail"
                   name="requestingEmail"
                   placeholder="investigator@peelpolice.ca"
                   required>
            <div class="invalid-feedback"></div>
          </div>
        </div>

        <!-- Clear investigator info button -->
        <div class="form-group text-right">
          <button type="button"
                  class="btn btn-sm btn-secondary"
                  id="clearOfficerInfo">
            Clear Investigator Info
          </button>
          <small class="form-text d-block mt-1">
            Removes saved investigator information from this browser
          </small>
        </div>
      </section>

      <!-- Location Information Section -->
      <section class="form-section">
        <h2 style="color: var(--color-primary); margin-bottom: 1.5rem;">Location Information</h2>

        <div class="form-group">
          <label for="businessName" class="form-label">Business Name</label>
          <input type="text"
                 class="form-control"
                 id="businessName"
                 name="businessName"
                 placeholder="Leave blank if none">
          <small class="form-text">Name of the business where video will be recovered</small>
        </div>

        <div class="form-group">
          <label for="locationAddress" class="form-label">
            Location Address <span class="required">*</span>
          </label>
          <input type="text"
                 class="form-control"
                 id="locationAddress"
                 name="locationAddress"
                 placeholder="Full address"
                 required>
          <div class="invalid-feedback"></div>
        </div>

        <div class="form-group">
          <label for="city" class="form-label">
            City <span class="required">*</span>
          </label>
          <select class="form-control" id="city" name="city" required>
            <option value="">Select city</option>
            <option value="Brampton">Brampton</option>
            <option value="Mississauga">Mississauga</option>
            <option value="Toronto">Toronto</option>
            <option value="Other">Other</option>
          </select>
          <div class="invalid-feedback"></div>
        </div>

        <!-- Conditional field for Other city -->
        <div class="form-group d-none" id="cityOtherGroup">
          <label for="cityOther" class="form-label">
            Specify City <span class="required">*</span>
          </label>
          <input type="text"
                 class="form-control"
                 id="cityOther"
                 name="cityOther"
                 placeholder="Enter city name">
          <small class="form-text">Please enter the city name</small>
          <div class="invalid-feedback"></div>
        </div>

        <!-- Row: Location Contact + Phone -->
        <div class="form-row">
          <div class="form-group">
            <label for="locationContact" class="form-label">
              Location Contact <span class="required">*</span>
            </label>
            <input type="text"
                   class="form-control"
                   id="locationContact"
                   name="locationContact"
                   placeholder="Contact person at location"
                   required>
            <div class="invalid-feedback"></div>
          </div>

          <div class="form-group">
            <label for="locationContactPhone" class="form-label">
              Location Contact Phone <span class="required">*</span>
            </label>
            <input type="tel"
                   class="form-control"
                   id="locationContactPhone"
                   name="locationContactPhone"
                   placeholder="XXX-XXX-XXXX"
                   required>
            <small class="form-text">10 digits required (dashes optional)</small>
            <div class="invalid-feedback"></div>
          </div>
        </div>
      </section>

      <!-- DVR Groups Container -->
      <div id="dvr-group-container">
        <!-- First DVR Group (always present) -->
        <div class="dvr-group" data-dvr-index="0" style="background: var(--glass-bg); border-radius: var(--border-radius); padding: 2rem; margin-bottom: 2rem; border: 2px solid var(--color-primary);">
          <h2 style="color: var(--color-primary); margin-bottom: 1.5rem; text-align: center; font-size: 1.5rem;">DVR 1</h2>

          <!-- DVR Information Section -->
          <section class="form-section">
            <h3 style="color: var(--color-primary); margin-bottom: 1.5rem;">DVR Information</h3>

            <div class="form-group">
              <label for="dvrMakeModel" class="form-label">DVR Make/Model</label>
              <input type="text"
                     class="form-control"
                     id="dvrMakeModel"
                     name="dvrMakeModel"
                     placeholder="e.g., Hikvision DS-7216">
              <small class="form-text">DVR system manufacturer and model number</small>
            </div>

            <div class="form-group">
              <label class="form-label">Is the Time & Date correct?</label>
              <small class="form-text mb-2 d-block">Is the DVR time synchronized with actual time?</small>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="isTimeDateCorrect" id="timeCorrectYes" value="Yes" required>
                <label class="form-check-label" for="timeCorrectYes">
                  Yes
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="isTimeDateCorrect" id="timeCorrectNo" value="No" required>
                <label class="form-check-label" for="timeCorrectNo">
                  No
                </label>
              </div>
              <div class="invalid-feedback"></div>
            </div>

            <!-- Time offset field (conditional, NOT required) -->
            <div class="form-group d-none" id="timeOffsetGroup">
              <label for="timeOffset" class="form-label">Time Offset</label>
              <input type="text"
                     class="form-control"
                     id="timeOffset"
                     name="timeOffset"
                     placeholder="e.g., DVR is 1hr 5min 30sec AHEAD of real time">
              <small class="form-text">Describe how the DVR time differs from actual time</small>
            </div>

            <div class="form-group">
              <label for="dvrRetention" class="form-label">DVR Retention</label>
              <input type="date"
                     class="form-control"
                     id="dvrRetention"
                     name="dvrRetention">
              <small class="form-text">The earliest date available on the DVR system</small>
              <div class="invalid-feedback"></div>
              <div id="retentionCalculation" class="text-info mt-2"></div>
            </div>

            <div class="form-group">
              <label class="form-label">Has Video Monitor?</label>
              <small class="form-text mb-2 d-block">Is there a monitor connected to view video?</small>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="hasVideoMonitor" id="monitorYes" value="Yes">
                <label class="form-check-label" for="monitorYes">
                  Yes
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="hasVideoMonitor" id="monitorNo" value="No">
                <label class="form-check-label" for="monitorNo">
                  No
                </label>
              </div>
            </div>
          </section>

          <!-- Video Extraction Details Container for this DVR -->
          <div class="extraction-timeframe-container" data-dvr-index="0">
            <!-- First time frame (always present) -->
            <div class="extraction-timeframe-group" data-group-index="0" data-dvr-index="0" style="background: rgba(255,255,255,0.05); border-radius: var(--border-radius); padding: 1.5rem; margin-bottom: 1.5rem; border: 1px solid var(--border-color);">
              <section class="form-section">
                <h4 style="color: var(--color-secondary); margin-bottom: 1.5rem;">Video Extraction Details</h4>

                <!-- Row: Start Time + End Time -->
                <div class="form-row">
                  <div class="form-group">
                    <label for="extractionStartTime" class="form-label">
                      Time Period From <span class="required">*</span>
                    </label>
                    <input type="datetime-local"
                           class="form-control"
                           id="extractionStartTime"
                           name="extractionStartTime"
                           required>
                    <small class="form-text">Start of video period to extract</small>
                    <div class="invalid-feedback"></div>
                  </div>

                  <div class="form-group">
                    <label for="extractionEndTime" class="form-label">
                      Time Period To <span class="required">*</span>
                    </label>
                    <input type="datetime-local"
                           class="form-control"
                           id="extractionEndTime"
                           name="extractionEndTime"
                           required>
                    <small class="form-text">End of video period to extract</small>
                    <div class="invalid-feedback"></div>
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">
                    Time Period Type <span class="required">*</span>
                  </label>
                  <small class="form-text mb-2 d-block">Are the times above in DVR time or actual time?</small>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="timePeriodType" id="timeDVR" value="DVR Time" required>
                    <label class="form-check-label" for="timeDVR">
                      DVR Time
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="timePeriodType" id="timeActual" value="Actual Time" required>
                    <label class="form-check-label" for="timeActual">
                      Actual Time
                    </label>
                  </div>
                  <div class="invalid-feedback"></div>
                </div>

                <div class="form-group">
                  <label for="cameraDetails" class="form-label">
                    Camera Details <span class="required">*</span>
                  </label>
                  <textarea class="form-control"
                            id="cameraDetails"
                            name="cameraDetails"
                            rows="4"
                            placeholder="List camera locations/angles needed (e.g., Front entrance, Cash register, Parking lot west side)"
                            required></textarea>
                  <small class="form-text">Please list specific cameras or areas to be extracted</small>
                  <div class="invalid-feedback"></div>
                </div>
              </section>
            </div>
          </div>

          <!-- Add Time Frame Button for this DVR -->
          <div style="text-align: center; margin: 1.5rem 0;">
            <button type="button" class="btn btn-secondary add-timeframe-btn" data-dvr-index="0" style="min-width: 200px;">
              + Add Additional Time Frame
            </button>
            <small class="form-text d-block mt-2">
              Add if you need to extract video from multiple time periods for this DVR
            </small>
          </div>

          <!-- Access Information Section -->
          <section class="form-section">
            <h3 style="color: var(--color-primary); margin-bottom: 1.5rem;">Access Information</h3>

            <!-- Row: Username + Password -->
            <div class="form-row">
              <div class="form-group">
                <label for="dvrUsername" class="form-label">Username</label>
                <input type="text"
                       class="form-control"
                       id="dvrUsername"
                       name="dvrUsername"
                       placeholder="DVR login username">
              </div>

              <div class="form-group">
                <label for="dvrPassword" class="form-label">
                  Password <span class="required">*</span>
                </label>
                <input type="text"
                       class="form-control"
                       id="dvrPassword"
                       name="dvrPassword"
                       placeholder="DVR login password"
                       required>
                <small class="form-text">DVR access password (plain text)</small>
                <div class="invalid-feedback"></div>
              </div>
            </div>
          </section>
        </div>
      </div>

      <!-- Add DVR Button -->
      <div style="text-align: center; margin: 2rem 0;">
        <button type="button" class="btn btn-primary" id="addDVRBtn" style="min-width: 250px; font-size: 1.1rem; padding: 0.75rem 2rem;">
          + Add Another DVR System
        </button>
        <small class="form-text d-block mt-2">
          Add if you need to recover from multiple DVR systems
        </small>
      </div>

      <!-- Additional Information Section -->
      <section class="form-section">
        <h2 style="color: var(--color-primary); margin-bottom: 1.5rem;">Additional Information</h2>

        <div class="form-group">
          <label for="incidentDescription" class="form-label">
            Incident Description <span class="required">*</span>
          </label>
          <textarea class="form-control"
                    id="incidentDescription"
                    name="incidentDescription"
                    rows="6"
                    placeholder="Provide a detailed description of the incident including what happened, when it occurred, and any relevant details for the video recovery"
                    required></textarea>
          <div class="invalid-feedback"></div>
        </div>
      </section>

      <!-- Form Actions -->
      <div class="form-actions" style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
        <button type="submit" class="btn btn-primary" style="min-width: 150px;">
          Submit Request
        </button>
        <button type="reset" class="btn btn-secondary" style="min-width: 150px;">
          Clear Form
        </button>
      </div>
    </form>

    <!-- Progress Bar -->
    <div class="progress-container" style="position: fixed; bottom: 0; left: 0; right: 0; background: var(--surface-dark); padding: 1rem; border-top: 1px solid var(--border-color);">
      <div class="progress-label" style="text-align: center; margin-bottom: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">
        <span id="progress-percentage">0%</span> Complete
      </div>
      <div class="progress" style="height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden;">
        <div class="progress-bar" id="form-progress" style="width: 0%; height: 100%; background: var(--color-danger); transition: all 0.3s ease; border-radius: 4px;"></div>
      </div>
    </div>
  </main>

  <!-- JavaScript Modules -->
  <script type="module">
    import { CONFIG } from './assets/js/config.js';
    import { RecoveryFormHandler } from './assets/js/form-handlers/form-handler-recovery.js';
    import { initHeader } from './assets/js/header-component.js';
    import { initPWA } from './assets/js/pwa-register.js';

    // Initialize header with form title
    initHeader('CCTV Recovery Request Form');

    // Initialize form handler
    const formHandler = new RecoveryFormHandler('recovery-form');

    // Initialize PWA
    initPWA();
  </script>
</body>
</html>
